<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Modbus EVC</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
         :root {
            --text-light: rgba(255, 255, 255, 0.6);
            --text-lighter: rgba(255, 255, 255, 0.9);
            --spacing-s: 8px;
            --spacing-m: 16px;
            --spacing-l: 24px;
            --spacing-xl: 32px;
            --spacing-xxl: 64px;
            --width-container: 1200px;
        }
        
        @import url("https://fonts.googleapis.com/css2?family=Montserrat&display=swap");
        * {
            box-sizing: border-box;
        }
        
         :root {
            --dark-color: hsl(var(--hue), 100%, 9%);
            --light-color: hsl(var(--hue), 95%, 98%);
            --base: hsl(var(--hue), 95%, 50%);
            --complimentary1: hsl(var(--hue-complimentary1), 95%, 50%);
            --complimentary2: hsl(var(--hue-complimentary2), 95%, 50%);
            --font-family: "Poppins", system-ui;
            --bg-gradient: linear-gradient( to bottom, hsl(var(--hue), 95%, 99%), hsl(var(--hue), 95%, 84%));
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            border: 0;
        }
        
        html {
            display: grid;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            max-width: 1920px;
            min-height: 100vh;
            display: grid;
            place-items: center;
            padding: 2rem;
            font-family: var(--font-family);
            background-color: #FFDEE9;
            background-image: linear-gradient(0deg, #ffffff 0%, #bef2f2 100%);
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: cover;
        }
        
        .orb-canvas {
            place-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        strong {
            font-weight: 600;
        }
        
        .container-fluid {
            margin-top: 50px;
            width: 10%;
            margin-right: 3000px;
        }
        
        .form-group label {
            font-weight: bold;
            font-size: small;
            text-align: center;
        }
        
        .btn {
            align-items: center;
            background-image: -webkit-linear-gradient(#f9aa5b, #d6c43a);
        }
        
        .form-container {
            border: 1px solid #fafafa;
            border-radius: 5px;
            box-shadow: 0px 2px 6px rgba(219, 176, 176, 0.1);
            padding: 20px;
            background-color: white;
        }
        
        .btn-container {
            position: absolute;
            margin-left: 434px;
            width: 205px;
            margin-top: -245px;
        }
        
        .btn-buttonElster {
            margin-left: 1px;
            position: absolute;
            margin-top: 100px;
        }
        
        .btn-buttonActaris {
            margin-left: 1px;
            position: absolute;
            margin-top: 180px;
        }
        
        .btn-button1 p {
            display: flex;
            position: absolute;
            margin-left: 1px;
            margin-top: 70px;
        }
        
        .btn-button2 p {
            display: flex;
            position: absolute;
            margin-left: 1px;
            margin-top: 153px;
        }
        
        .btn-warning {
            position: absolute;
            background-image: -webkit-linear-gradient(#f9aa5b, #d6c43a);
        }
        
        .data-info {
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .data-info h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        /* สไตล์สำหรับตาราง */
        
        table {
            top: 600px;
        }
        
        td {
            padding: 9px;
            border: 1px solid #868585;
            background-color: #ffffff;
            font-size: 10px;
        }
        
        th {
            background: rgba(174, 149, 7, 0.4);
        }
        /* สไตล์สำหรับปุ่มและการจัดกลุ่มของปุ่ม */
        
        .btn-group {
            margin-top: 10px;
            justify-content: center;
            gap: 10px;
        }
        /* สไตล์สำหรับช่องข้อมูลที่ใช้ความกว้างเต็มและมีพื้นหลัง */
        
        .full-width-input {
            width: 100%;
            height: 100%;
            background-color: #0980f7;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .col-sm-9 {
            display: grid;
            top: 10px;
            right: 0px;
        }
        
        #communicationTrafficContainer {
            margin: -75px 0px 100px 700px;
        }
        
        #colSm9Container {
            display: grid;
            position: relative;
            margin-bottom: 10px;
        }
        
        .btn-primary1 {
            position: sticky;
            display: flex;
            left: 770px;
            top: 203px;
        }
    </style>

</head>

<body>












    <!-- Canvas -->
    <canvas id="orbcanvas" class="orb-canvas"></canvas>
    <!-- Overlay -->
    <div class="overlay" id="overlay">

        <!-- Overlay inner wrapper -->
        <div class="overlay__inner">
            <!-- Title -->

            <!-- Description -->
            <div class="list-container" id="listcontainer">

                <div class="menu-icon-wrapper">

                </div>
                </button>

            </div>

            <div class="container-fluid" id="containerfluid">
                <div class="row">
                    <div class="col-sm-6 offset-sm-3 pt-4">

                        <form method="POST" id="modbusForm">




                            <div class="form-group" style="display: none;  ">
                                <label for="slave_id" style="margin-bottom: 100px;">Slave ID</label>
                                <input type="number" class="form-control" id="slave_id" name="slave_id" value="1" required style="height: 30px; width: 100%; font-size: x-small; margin-top: -100px; border-radius: 0.5rem; border: none; padding-left: 10px;">
                            </div>

                            <div class="form-group" style="display: none;">
                                <label for="function_code" style="margin-bottom: 100px;">Function Code</label>
                                <input type="number" class="form-control" id="function_code" name="function_code" value="3" required style="height: 30px; width: 100%; font-size: x-small; margin-top: -100px; border-radius: 0.5rem; border: none; padding-left: 10px;">
                            </div>

                            <div class="form-group">
                                <label for="starting_address">Starting Address</label>
                                <select class="form-control" id="starting_address" name="starting_address" required style="height: 30px;width: 100%; font-size: x-small; margin-top: -7px; border-radius: 0.5rem;border: none;padding-left: 10px;">
                      <option value="">Select an option...</option> 

                      <option value="custom">Custom</option>
                      <option value="8000">8000 ( daily elster)</option>
                      <option value="7003">7003 ( config elster)</option>
                      <option value="20482">20482 ( daily actaris)</option>
                      <option value="32">32 (config actaris)</option>
                      <!-- Option for custom input -->
                  </select>
                            </div>

                            <!-- Input field for custom value -->
                            <div class="form-group">
                                <label for="custom_starting_address">Custom Starting Address</label>
                                <input type="number" class="form-control" id="custom_starting_address" name="custom_starting_address" style="height: 30px;width: 100%; font-size: x-small;margin-top: -7px; border-radius: 0.5rem;border: none;padding-left: 10px;">
                            </div>


                            <div class="form-group">
                                <label for="quantity">Quantity</label>
                                <input type="number" class="form-control" id="quantity" name="quantity" value="{{60}}" required style="height: 30px;width: 100%; font-size: x-small;margin-top: -7px; border-radius: 0.5rem;border: none;padding-left: 10px;">

                            </div>
                            <div class="form-group">
                                <label for="tcp_ip">TCP IP</label>
                                <input type="text" class="form-control" id="tcp_ip" name="tcp_ip" value="" required style="height: 30px;width: 100%; font-size: x-small;margin-top: -7px; border-radius: 0.5rem;border: none;padding-left: 10px;">
                            </div>


                            <div class="form-group">
                                <label for="tcp_port">TCP Port</label>
                                <select class="form-control" id="tcp_port" name="tcp_port" required style="height: 30px;width: 100%; font-size:x-small;margin-top: -7px; border-radius: 0.5rem; border: none;padding-left: 10px;">
                      <option value="">Select a TCP Port</option>
                      <option value="2101">2101</option>
                      <option value="2102">2102</option>
                      <option value="2103">2103</option>
                      <option value="2104">2104</option>
                      <option value="2402">2402</option>
                      <option value="2404">2404</option>
                      <option value="4001">4001</option>
                      <option value="4002">4002</option>
                      <option value="4003">4003</option>
                      <option value="4004">4004</option>
                      <option value="6000">6000</option>
                  </select>

                            </div>





                            <div class="btn-container" id="showDataButton">
                                <!-- เพิ่มปุ่มสำหรับเปลี่ยนเป็น 16-bit -->

                                <button type="submit" id="changeTo16BitButton" class="btn btn-primary" name="is_16bit" value="true" data-state="data" style="height: 34px; width: 45%; font-size: x-small;border-radius: 0.5rem;border: none;">Change to 16-bit</button >

                  <!-- เพิ่มปุ่มสำหรับเปลี่ยนเป็น 32-bit -->
                  <button type="submit" id="changeTo32BitButton" class="btn btn-secondary" name="is_16bit" value="false"style="height: 34px; width: 45%; font-size: x-small;border: none;border-radius: 0.5rem;">Change to 32-bit</button>

                                <div class="btn-button1">
                                    <p>Elster:</p>
                                </div>
                                <div class="btn-buttonElster">

                                    <!-- ... เพิ่มฟิลด์และปุ่มของ Elster ตามที่คุณต้องการ ... -->
                                    <button type="submit" class="btn btn-secondary" value="false" style="height: 34px; width: 80px; font-size: x-small; border: none;border-radius: 0.5rem;">Daily Data</button>
                                    <button type="submit" class="btn btn-secondary" value="false" style="height: 34px; width: 104px; font-size: x-small;border: none;border-radius: 0.5rem;">Configuration</button>
                                </div>
                                <div class="btn-button2">
                                    <p>Actaris:</p>
                                </div>
                                <!-- ... เพิ่มฟิลด์และปุ่มของ Actaris ตามที่คุณต้องการ ... -->
                                <div class="btn-buttonActaris">


                                    <button type="submit" name="action_actaris" value="daily_data" style="height: 34px; width: 80px; font-size: x-small; border: none; border-radius: 0.5rem; background-image: -webkit-linear-gradient(#f9aa5b, #d6c43a); ">
                                            Daily Data
                                        </button>


                                    <button type="submit" name="action_configuration" value="configuration" style="height: 34px; width: 104px; font-size: x-small; border: none;border-radius: 0.5rem;background-image: -webkit-linear-gradient(#f9aa5b, #d6c43a);">Configuration</button>
                                </div>
                                <!-- Add a button to download the "Communication Traffic" table as an Excel file -->



                            </div>
                        </form>

                        <!-- Your Modbus form content here -->


                        <div id="datePickerContainer"></div>



                    </div>
                    <div class="col-sm-3 t pt-2">


                        </form>
                    </div>
                    <div class="btn-warning" style="top: 100px; position: relative;">
                        <button type="button" class="btn btn-warning" onclick="clearForm()" id="clearFormButton" style="height: 34px; width: 190px; margin-left: 434px; margin-top: -300px; border: none;border-radius: 0.5rem;">Clear</button>
                    </div>






                    <!-- Buttons -->
                    <div class="overlay__btns">




                    </div>
                </div>
            </div>

            <!-- partial -->

        </div>
    </div>

    </div>


    <div id="colSm9Container" class="col-sm-9">
        <div class="table-responsive " style="width:100%; height: 100px; margin-right: 3500px;margin-top: 100px;">
            <h4 class="text-center">แสดงข้อมูล</h4>
            {% if data_list %}
            <h4>Data for {{ selected_date }}</h4>
            <table class="table table-hover">
                <thead>

                    <tr>
                        <th>Description</th>
                        <th>Value</th>
                        <th>Address</th>

                        <th>HEX Value</th>
                        <th>Binary Value</th>

                        <th> float_value</th>

                    </tr>
                </thead>
                <tbody>
                    {% for data in data_list %}
                    <tr>
                        <td>{{ data['description'] }}</td>
                        <td>{{ data['value'] }}</td>
                        <td>{{ data['address'] }}</td>

                        <td>{{ data['hex_value'] }}</td>
                        <td>{{ data['binary_value'] }}</td>

                        <td>
                            {% if data['is_16bit'] or data['address'] in [ 20482,20494,20498,20512,20524,20528,20543,20555,20559,20573,20585,20589,546,756,7015,7017,7019,7021,7031,7033,7035,7003,8000,8002,8004,8010,8012,8014,8020,8022,8024,8030,8032,8034,8040,8042,8044,8050,8052,8054,8060,8062,8064,8070,8072,8074,8080,8082,8084]
                            %} {{ data['signed_value'] }}
                            <!-- แสดง signed_value สำหรับ signed หรือ Ulong -->
                            {% else %} {{ data['float_value'] }}
                            <!-- แสดง float_value สำหรับ float และอื่น ๆ -->
                            {% endif %}
                        </td>



                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            {% endif %}
        </div>
    </div>





    <div id="communicationTrafficContainer" class="communication-traffic">
        <h4>Communication Traffic</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Direction</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
                {% for data in communication_traffic %}
                <tr>
                    <td>{{ data['direction'] }}</td>
                    <td>{{ data['data'] }}</td>
                </tr>

                {% endfor %}
            </tbody>
        </table>

    </div>




    <script>
        document.addEventListener("DOMContentLoaded", function() {

            const colSm9Container = document.getElementById("colSm9Container");
            const communicationTrafficContainer = document.getElementById("communicationTrafficContainer");
            const overlay = document.getElementById("overlay");
            const showModbusFormButton = document.getElementById("showModbusFormButton");
            const showCommunicationButton = document.getElementById("showCommunicationButton");
            const modbus1 = document.getElementById("modbus1");
            const clearFormButton = document.getElementById("clearFormButton");
            const modbusForm = document.getElementById("modbusForm");
            const containerfluid = document.getElementById("containerfluid");
            const home1 = document.getElementById("home1");
            const event = document.getElementById("event");
            const loadingElement = document.getElementById("loading");
            const showDataButton = document.getElementById("showDataButton");


            showDataButton.addEventListener("click", function() {

                //event.preventDefault();
                clearFormButton.style.display = "none";
                colSm9Container.style.display = "block";
                communicationTrafficContainer.style.display = "block";
                overlay.style.margin = "0px 3110px 0px 0px";
                showModbusFormButton.style.display = "block";
                modbusForm.style.display = "none";
                home1.style.display = "none";
                card1.style.display = "none";
                modbusForm.style.display = "none";

            });
            showModbusFormButton.addEventListener("click", function() {
                modbusForm.style.display = "block";
                clearFormButton.style.display = "block";
                overlay.style.display = "block";
                colSm9Container.style.display = "none";
                communicationTrafficContainer.style.display = "none";
                showModbusFormButton.style.display = "none";
                overlay.style.display = "flex";
                overlay.style.margin = "0px 0px 0px 0px";

            });
        });




        function clearForm() {
            document.getElementById("slave_id").value = "";
            document.getElementById("function_code").value = "";
            document.getElementById("starting_address").value = "";
            document.getElementById("quantity").value = "";


            var communicationTrafficTable = document.querySelector(".communication-traffic table tbody");
            communicationTrafficTable.innerHTML = "";

            // Clear the response data
            var responseDataTable = document.querySelector(".table.table-hover tbody");
            responseDataTable.innerHTML = "";


        }


        // เพิ่มฟังก์ชันสำหรับเปลี่ยนเป็น 16-bit
        function changeTo16Bit() {
            document.getElementById("is_16bit").value = "true";
            const startingAddressInput = document.getElementById("starting_address");
            const quantityInput = document.getElementById("quantity");

            startingAddressInput.max = 65535;
            quantityInput.max = 65535;

        }

        function changeTo32Bit() {
            document.getElementById("is_16bit").value = "false";
            const startingAddressInput = document.getElementById("starting_address");
            const quantityInput = document.getElementById("quantity");

            startingAddressInput.max = 4294967295;
            quantityInput.max = 4294967295;

        }


        function updateTable(data_list) {
            const responseDataTable = document.querySelector(".table.table-hover tbody");
            responseDataTable.innerHTML = "";

            for (const data of data_list) {
                const newRow = document.createElement("tr");
                const addressCell = document.createElement("td");
                addressCell.textContent = data.address;
                newRow.appendChild(addressCell);

                const valueCell = document.createElement("td");
                valueCell.textContent = data.value;
                newRow.appendChild(valueCell);

                const hexValueCell = document.createElement("td");
                hexValueCell.textContent = "0x" + Number(data.value).toString(16).toUpperCase(); // Convert to HEX and display
                newRow.appendChild(hexValueCell);

                const floatCell = document.createElement("td");
                if (data.is_16bit || [8000, 7003, 20482, 32].includes(data.address)) {
                    floatCell.textContent = data.signed_value;
                } else if (data.float_value.includes('e')) {
                    const floatValue = parseFloat(data.float_value);
                    floatCell.textContent = floatValue.toExponential(); // Convert back to exponential notation
                } else {
                    floatCell.textContent = data.float_value;
                }
                newRow.appendChild(floatCell);

                responseDataTable.appendChild(newRow);

            }
        }
    </script>
    <!-- ส่วนของการเรียกใช้ Bootstrap 4 JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" async></script>

    <!-- Include xlsx.full.min.js for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js" async></script>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous" async></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js" integrity="sha384-bnBEpT0F5Fqx3pZlqVuAZMOLEH7B5P9RVoCkAPbQp9r1fB2MWXHI5I0aRUWoJ6fG" crossorigin="anonymous" async></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous" async></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous" async></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous" async></script>





</body>






</html>